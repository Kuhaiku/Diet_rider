<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diet Admin | Gestor v40 DB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style type="text/tailwindcss">
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; height: 100dvh; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .fade-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.99); } to { opacity: 1; transform: scale(1); } }
        .mobile-overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(2px); }
    </style>
</head>
<body class="flex overflow-hidden text-slate-800 bg-slate-50">

    <div id="mobile-overlay" class="fixed inset-0 mobile-overlay z-20 hidden md:hidden transition-opacity"></div>
    <aside id="sidebar" class="fixed inset-y-0 left-0 z-30 w-64 bg-white border-r border-slate-200 shadow-xl md:shadow-sm transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col h-full">
        <div class="p-6 border-b border-slate-100 flex justify-between items-center">
            <div class="flex items-center gap-3 text-slate-800 font-bold text-xl tracking-tight">
                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white shadow-blue-200 shadow-lg"><i class="fa-solid fa-layer-group"></i></div>
                DietCMS
            </div>
            <button id="btn-close-sidebar" class="md:hidden text-slate-400 hover:text-red-500"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>
        <div class="px-6 py-4 border-b border-slate-50">
            <p class="text-xs text-slate-400 font-medium mb-1">Logado como:</p>
            <p class="text-sm font-bold text-slate-800 truncate mb-2" id="user-display">Carregando...</p>
            <a href="tutorial.html" class="flex items-center justify-center w-full px-3 py-1.5 text-xs font-bold text-blue-600 bg-blue-50 border border-blue-100 rounded-md hover:bg-blue-100 transition-colors"><i class="fa-solid fa-circle-question mr-2"></i> Ver Tutorial</a>
        </div>
        <nav class="flex-1 p-4 overflow-y-auto space-y-1">
            <p class="px-3 text-[10px] font-extrabold text-slate-400 uppercase tracking-wider mb-3 mt-2">GERENCIAMENTO</p>
            <button id="nav-presets" onclick="switchView('presets')" class="flex items-center w-full px-4 py-3 text-sm font-medium text-slate-600 rounded-lg hover:bg-slate-50 transition-colors mb-1"><i class="fa-solid fa-folder-open w-5 text-slate-400"></i> Meus Planos</button>
            <button id="nav-planner" onclick="switchView('planner')" class="flex items-center w-full px-4 py-3 text-sm font-medium text-slate-600 rounded-lg hover:bg-slate-50 transition-colors mb-1"><i class="fa-solid fa-calendar-days w-5 text-slate-400"></i> Planejador Atual</button>
            <button id="nav-library" onclick="switchView('library')" class="flex items-center w-full px-4 py-3 text-sm font-medium text-slate-600 rounded-lg hover:bg-slate-50 transition-colors mb-1"><i class="fa-solid fa-book-open w-5 text-slate-400"></i> Biblioteca (Estoque)</button>
            <div class="mt-6 pt-6 border-t border-slate-100">
                <p class="px-3 text-[10px] font-extrabold text-slate-400 uppercase tracking-wider mb-3">INTELIG√äNCIA ARTIFICIAL</p>
                <button onclick="openPromptGen()" class="flex items-center w-full px-4 py-3 text-sm font-bold text-indigo-600 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition-colors mb-2 border border-indigo-100 shadow-sm"><i class="fa-solid fa-wand-magic-sparkles w-5"></i> Gerador de Prompts</button>
            </div>
            <div class="mt-4 pt-4 border-t border-slate-100">
                <button onclick="exportToApp()" class="flex items-center w-full px-4 py-3 text-sm font-bold text-green-700 bg-green-50 rounded-lg hover:bg-green-100 transition-colors mb-2 border border-green-100 shadow-sm"><i class="fa-solid fa-rocket w-5"></i> Publicar no App</button>
                <a href="app.html" target="_blank" class="flex items-center w-full px-4 py-3 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"><i class="fa-solid fa-external-link-alt w-5"></i> Ver App Online</a>
            </div>
            <button onclick="logout()" class="flex items-center w-full px-4 py-3 mt-4 text-sm font-bold text-red-500 hover:bg-red-50 rounded-lg transition-colors border border-red-100"><i class="fa-solid fa-right-from-bracket w-5"></i> Sair</button>
        </nav>
    </aside>

    <main class="flex-1 flex flex-col min-w-0 bg-slate-50 relative md:ml-64 transition-all duration-300 h-full">
        <div class="md:hidden h-16 bg-white border-b border-slate-200 flex items-center justify-between px-4 sticky top-0 z-20 shadow-sm flex-shrink-0">
            <span class="font-bold text-lg text-slate-800 flex items-center gap-2"><i class="fa-solid fa-layer-group text-blue-600"></i> DietCMS</span>
            <button id="btn-open-sidebar" class="p-2 text-slate-600 hover:bg-slate-100 rounded-lg"><i class="fa-solid fa-bars text-xl"></i></button>
        </div>

        <div id="view-presets" class="flex-1 flex flex-col h-full fade-in overflow-hidden">
            <div class="bg-white shadow-sm z-10 border-b border-slate-200 p-4 md:px-8 md:h-20 flex flex-col md:flex-row md:items-center justify-between gap-4 flex-shrink-0">
                <div><h2 class="text-xl font-bold text-slate-800">Meus Planos</h2><p class="text-xs text-slate-500 mt-0.5 hidden md:block">Gerencie seus planejamentos salvos no Banco de Dados.</p></div>
                <div class="flex gap-2 w-full md:w-auto">
                    <button onclick="openImportModal('plan')" class="flex-1 md:flex-none justify-center bg-white border border-slate-300 text-slate-700 px-4 py-2 rounded-lg text-sm font-bold hover:bg-slate-50 cursor-pointer flex items-center gap-2 shadow-sm whitespace-nowrap"><i class="fa-solid fa-paste text-blue-600"></i> Importar (Colar)</button>
                    <button onclick="saveCurrentAsPreset()" class="flex-1 md:flex-none justify-center bg-slate-800 hover:bg-slate-900 text-white px-5 py-2 rounded-lg text-sm font-bold shadow-lg flex items-center gap-2 whitespace-nowrap"><i class="fa-solid fa-floppy-disk"></i> Salvar</button>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto p-4 md:p-8 pb-32">
                <div id="presets-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                <div id="empty-presets" class="hidden flex flex-col items-center justify-center h-96 text-slate-400"><i class="fa-solid fa-cloud-arrow-up text-4xl mb-3 text-slate-300"></i><p class="font-medium text-center">Nenhum plano salvo na nuvem.</p></div>
            </div>
        </div>

        <div id="view-planner" class="hidden flex-1 flex flex-col h-full fade-in overflow-hidden">
            <div class="bg-white shadow-sm z-10 border-b border-slate-200 p-4 md:px-8 md:h-20 flex flex-col md:flex-row md:items-center justify-between gap-4 flex-shrink-0">
                <div><h2 class="text-xl font-bold text-slate-800">Planejador Atual</h2><p class="text-xs text-slate-500 mt-0.5 hidden md:block">Editando o calend√°rio ativo.</p></div>
                <div class="flex items-center gap-2 text-xs font-medium text-slate-500 bg-slate-100 px-3 py-1.5 rounded-full border border-slate-200 self-start md:self-auto"><i class="fa-solid fa-info-circle text-blue-500"></i> Clique nas c√©lulas vazias</div>
            </div>
            <div class="flex-1 overflow-y-auto p-4 md:p-8 pb-40">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-8"><div class="overflow-x-auto"><table class="w-full border-collapse min-w-[800px]"><thead><tr class="bg-slate-50 border-b border-slate-200 text-left"><th class="px-6 py-4 text-xs font-bold text-slate-400 uppercase w-24 text-center border-r border-slate-200">Semana</th><th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase w-1/4">Caf√©</th><th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase w-1/4">Almo√ßo</th><th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase w-1/4">Lanche</th><th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase w-1/4">Jantar</th></tr></thead><tbody id="planner-body" class="divide-y divide-slate-100"></tbody></table></div></div>
                <h3 class="text-sm font-bold text-slate-700 mt-8 mb-4">Temas das Semanas</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm"><label class="text-[10px] font-bold text-slate-400 uppercase">Semana 1</label><input type="text" id="theme-w1" class="w-full mt-1 bg-slate-50 border border-slate-200 rounded p-2 text-sm focus:outline-none focus:border-blue-500" onchange="saveThemes()"></div>
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm"><label class="text-[10px] font-bold text-slate-400 uppercase">Semana 2</label><input type="text" id="theme-w2" class="w-full mt-1 bg-slate-50 border border-slate-200 rounded p-2 text-sm focus:outline-none focus:border-blue-500" onchange="saveThemes()"></div>
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm"><label class="text-[10px] font-bold text-slate-400 uppercase">Semana 3</label><input type="text" id="theme-w3" class="w-full mt-1 bg-slate-50 border border-slate-200 rounded p-2 text-sm focus:outline-none focus:border-blue-500" onchange="saveThemes()"></div>
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm"><label class="text-[10px] font-bold text-slate-400 uppercase">Semana 4</label><input type="text" id="theme-w4" class="w-full mt-1 bg-slate-50 border border-slate-200 rounded p-2 text-sm focus:outline-none focus:border-blue-500" onchange="saveThemes()"></div>
                </div>
            </div>
        </div>

        <div id="view-library" class="hidden flex-1 flex flex-col h-full fade-in overflow-hidden">
            <div class="bg-white shadow-sm z-10 border-b border-slate-200 p-4 md:px-8 md:h-20 flex flex-col md:flex-row md:items-center justify-between gap-4 flex-shrink-0">
                <div class="flex items-center gap-4">
                    <div>
                        <h2 class="text-xl font-bold text-slate-800">Estoque de Receitas</h2>
                        <p class="text-xs text-slate-500 mt-0.5 hidden md:block">Gerencie e compartilhe suas receitas.</p>
                    </div>
                    <button id="btn-export-selected" onclick="exportSelectedRecipes()" class="hidden px-3 py-1.5 bg-indigo-600 text-white text-xs font-bold rounded-lg shadow-md hover:bg-indigo-700 transition-all items-center gap-2 animate-fade-in">
                        <i class="fa-solid fa-share-nodes"></i> Exportar (<span id="count-selected">0</span>)
                    </button>
                </div>
                <div class="flex gap-2 w-full md:w-auto">
                    <button onclick="downloadAllRecipes()" class="flex-none justify-center bg-white border border-slate-300 text-slate-600 px-3 py-2 rounded-lg text-sm font-bold hover:bg-slate-50 shadow-sm whitespace-nowrap" title="Baixar Backup Completo"><i class="fa-solid fa-box-archive"></i></button>
                    <button onclick="openImportModal('recipe')" class="flex-1 md:flex-none justify-center bg-white border border-slate-300 text-slate-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-slate-50 cursor-pointer flex items-center gap-2 transition-all shadow-sm whitespace-nowrap"><i class="fa-solid fa-paste text-blue-500"></i> Importar</button>
                    <button onclick="openRecipeModal()" class="flex-1 md:flex-none justify-center bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg text-sm font-bold shadow-lg shadow-blue-200 transition-all flex items-center gap-2 whitespace-nowrap"><i class="fa-solid fa-plus"></i> Nova Receita</button>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto p-4 md:p-8 pb-32">
                <div id="recipe-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
                <div id="empty-library" class="hidden flex flex-col items-center justify-center h-96 text-slate-400"><i class="fa-solid fa-basket-shopping text-4xl mb-3 text-slate-300"></i><p class="font-medium text-center">Nenhuma receita cadastrada.</p></div>
            </div>
        </div>
    </main>

    <div id="prompt-modal" class="fixed inset-0 bg-slate-900/60 hidden z-50 flex items-center justify-center backdrop-blur-sm p-4"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-full md:h-auto md:max-h-[90vh] flex flex-col overflow-hidden border border-slate-200"><div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-indigo-50"><h3 class="font-bold text-lg text-indigo-900 flex items-center gap-2"><i class="fa-solid fa-wand-magic-sparkles"></i> Gerador de Prompts</h3><button onclick="closePromptGen()" class="text-slate-400 hover:text-indigo-600"><i class="fa-solid fa-xmark text-xl"></i></button></div><div class="flex-1 overflow-y-auto p-6 space-y-4"><div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">O que voc√™ quer criar?</label><select id="gen-type" onchange="toggleGenInputs()" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-sm font-bold text-slate-700 outline-none focus:border-indigo-500"><option value="plan">Plano Completo (4 Semanas)</option><option value="recipe">Pacote de Receitas</option></select></div><div id="gen-qty-container" class="hidden"><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Quantidade de Receitas</label><input type="number" id="gen-qty" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-sm font-bold outline-none focus:border-indigo-500" value="5" placeholder="Ex: 5"></div><div><label class="block text-xs font-bold text-slate-500 uppercase mb-1" id="gen-input-label">Seu Perfil / Detalhes</label><textarea id="gen-input" class="w-full h-32 bg-slate-50 border border-slate-200 rounded-lg p-3 text-sm resize-none outline-none focus:border-indigo-500" placeholder="Ex: Mulher, 35 anos, objetivo emagrecimento..."></textarea></div><button onclick="generatePromptText()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg shadow-lg shadow-indigo-200 transition-all flex items-center justify-center gap-2"><i class="fa-solid fa-gear"></i> Gerar Prompt</button><div class="border-t border-slate-100 pt-4"><label class="block text-xs font-bold text-slate-400 uppercase mb-1">Resultado (Copie e cole na IA)</label><textarea id="gen-output" class="w-full h-32 bg-slate-900 text-green-400 rounded-lg p-3 text-xs font-mono resize-none" readonly></textarea></div></div><div class="p-4 border-t border-slate-100 bg-white flex justify-end gap-2"><button onclick="closePromptGen()" class="px-4 py-2 text-sm font-bold text-slate-500 hover:bg-slate-100 rounded-lg">Fechar</button><button onclick="copyPromptText()" class="px-6 py-2 text-sm font-bold bg-slate-800 text-white hover:bg-slate-900 rounded-lg shadow-lg flex items-center gap-2"><i class="fa-regular fa-copy"></i> Copiar</button></div></div></div>
    <div id="import-modal" class="fixed inset-0 bg-slate-900/60 hidden z-50 flex items-center justify-center backdrop-blur-sm p-4"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-full md:h-auto md:max-h-[80vh] flex flex-col overflow-hidden border border-slate-200"><div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-white"><div><h3 class="font-bold text-lg text-slate-800" id="import-title">Importar</h3><p class="text-xs text-slate-500">Cole o JSON (O sistema corrige erros).</p></div><button onclick="closeImportModal()" class="text-slate-400 hover:text-red-600"><i class="fa-solid fa-xmark text-xl"></i></button></div><div class="flex-1 p-0 overflow-hidden relative"><textarea id="import-text" class="w-full h-full p-4 bg-slate-50 text-xs font-mono resize-none focus:outline-none focus:bg-white transition-colors" placeholder='Cole aqui o resultado da IA...'></textarea><label class="absolute bottom-4 right-4 bg-white border border-slate-200 text-slate-500 px-3 py-1.5 rounded-lg text-xs font-bold shadow hover:bg-slate-50 cursor-pointer flex items-center gap-2"><i class="fa-solid fa-paperclip"></i> Ou carregar arquivo<input type="file" class="hidden" accept=".json" onchange="loadFileContent(this)"></label></div><div class="p-4 border-t border-slate-100 bg-white flex justify-end gap-2"><button onclick="closeImportModal()" class="px-4 py-2 text-sm font-bold text-slate-500 hover:bg-slate-100 rounded-lg">Cancelar</button><button onclick="processImport()" class="px-6 py-2 text-sm font-bold bg-blue-600 text-white hover:bg-blue-700 rounded-lg shadow-lg flex items-center gap-2"><i class="fa-solid fa-bolt"></i> Processar Dados</button></div></div></div>
    <div id="preview-modal" class="fixed inset-0 bg-slate-900/60 hidden z-50 flex items-center justify-center backdrop-blur-sm p-4"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-full md:h-auto md:max-h-[80vh] flex flex-col overflow-hidden border border-slate-200"><div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-white"><h3 class="font-bold text-lg text-slate-800" id="preview-title">Pr√©via</h3><button onclick="closePreview()" class="text-slate-400 hover:text-red-600"><i class="fa-solid fa-xmark text-xl"></i></button></div><div class="flex-1 overflow-y-auto p-6 bg-slate-50" id="preview-content"></div><div class="p-4 border-t border-slate-100 bg-white flex justify-end gap-2"><button onclick="closePreview()" class="px-4 py-2 text-sm font-bold text-slate-500 hover:bg-slate-100 rounded-lg">Fechar</button><button id="preview-confirm-btn" class="px-6 py-2 text-sm font-bold bg-slate-800 text-white hover:bg-slate-900 rounded-lg shadow-lg">Carregar</button></div></div></div>
    <div id="recipe-modal" class="fixed inset-0 bg-slate-900/60 hidden z-50 flex items-center justify-center backdrop-blur-sm transition-opacity p-4"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl h-full md:h-[90vh] flex flex-col overflow-hidden border border-slate-200"><div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-white"><h3 class="font-bold text-lg text-slate-800">Editor</h3><button onclick="closeModal()" class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 text-slate-500 hover:bg-red-100 hover:text-red-600"><i class="fa-solid fa-xmark"></i></button></div><div class="flex-1 overflow-y-auto p-4 space-y-6 md:p-8 bg-slate-50"><input type="hidden" id="edit-id"><div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200"><div class="grid grid-cols-1 md:grid-cols-12 gap-4"><div class="md:col-span-8"><input type="text" id="rec-name" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-4 py-3 text-lg font-bold" placeholder="Nome da Receita"></div><div class="grid grid-cols-2 gap-2 md:col-span-4 md:flex md:gap-4"><div class="w-full"><select id="rec-cat" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-3.5 text-sm"><option value="almoco">Almo√ßo</option><option value="jantar">Jantar</option><option value="cafe">Caf√©</option><option value="lanche">Lanche</option></select></div><div class="w-full"><select id="rec-icon" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-3.5 text-sm font-mono"><option value="fa-utensils">üç¥</option><option value="fa-drumstick-bite">üçó</option><option value="fa-leaf">ü•¨</option><option value="fa-bolt">‚ö°</option><option value="fa-mug-hot">‚òï</option></select></div></div></div></div><div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200"><div class="flex justify-between items-center mb-4"><h4 class="font-bold text-slate-700 text-sm">Ingredientes</h4><button onclick="addRecLine()" class="text-xs bg-blue-50 text-blue-600 font-bold px-3 py-1.5 rounded">+ Item</button></div><div id="rec-ingredients" class="space-y-2"></div></div><div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200"><div class="flex justify-between items-center mb-4"><h4 class="font-bold text-slate-700 text-sm">Passos</h4><button onclick="addStepLine()" class="text-xs bg-blue-50 text-blue-600 font-bold px-3 py-1.5 rounded">+ Passo</button></div><div id="rec-steps" class="space-y-3"></div></div></div><div class="p-4 border-t border-slate-100 bg-white flex justify-between items-center"><button onclick="closeModal()" class="px-6 py-2.5 rounded-lg text-sm font-bold text-slate-500 hover:bg-slate-100">Cancelar</button><button onclick="saveRecipeToLibrary()" class="bg-blue-600 text-white px-8 py-2.5 rounded-lg text-sm font-bold hover:bg-blue-700 shadow-lg">Salvar na Nuvem</button></div></div></div>
    <div id="picker-modal" class="fixed inset-0 bg-slate-900/40 hidden z-50 flex items-center justify-center backdrop-blur-sm p-4"><div class="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden"><div class="p-4 bg-slate-800 text-white flex justify-between items-center border-b border-slate-700"><h3 class="font-bold text-sm">Atribuir Receita</h3><button onclick="closePicker()" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark"></i></button></div><div class="p-3 bg-slate-50 border-b border-slate-200"><input type="text" id="picker-search" placeholder="Buscar..." class="w-full text-sm pl-4 py-2 rounded-lg border" onkeyup="renderPickerList()"></div><div id="picker-list" class="max-h-80 overflow-y-auto p-2 bg-white"></div></div></div>

    <script src="./js/admin.js"></script> 
</body>
</html>